services:
  db:
    image: mysql:8.0
    container_name: wiki_db
    environment:
      MYSQL_DATABASE: mwnew
      MYSQL_USER: mediawiki
      MYSQL_PASSWORD: nouseme
      MYSQL_ROOT_PASSWORD: nouseme2
    volumes:
      - dbdata:/var/lib/mysql
      # One-time init import (only runs if dbdata is empty on first boot)
      - ./db/mwnew.sql:/docker-entrypoint-initdb.d/001-mwnew.sql:ro
    restart: unless-stopped

  wiki:
    image: mediawiki:1.45.1
    container_name: wiki_app
    depends_on:
      - db
    ports:
      - "34371:80"     # Flux will map wikiworld.com -> this port
    volumes:
      - ./wiki/LocalSettings.php:/var/www/html/LocalSettings.php:ro
      # uploads don't matter, but MediaWiki still wants the directory writable
      - wikiimages:/var/www/html/images
    restart: unless-stopped

  landing:
    image: nginx:alpine
    container_name: eies.org_app
    ports:
      - "34370:80"     # Flux will map eies.org -> this port
    volumes:
      - ./eies.org:/usr/share/nginx/html:ro
    restart: unless-stopped

volumes:
  dbdata:
  wikiimages:

